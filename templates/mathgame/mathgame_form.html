{% extends "_base.html" %}
{% load static %}
{% load math_facts %}
{% load crispy_forms_tags %}

{% block title %}Math Facts Practice{% endblock %}
{% block main %}
  <div id="start" class="card border-info m-auto mb-3 p-3 bg-light"
    style="max-width: 30rem">
    <h1 class="text-center">Math Facts Practice</h1>
    {% if 'play' in request.path %}
      <div id="operation" class="card-header font-weight-bold text-center">{{ mathgame.get_operation_display }}</div>
      <br>
      {% randomNums as num1 %}
      <h1 class="text-center"> {{ num1 }} {{ mathgame.operation }} <span id="num2">13</span></h1>
    {% endif %}
    <form method="post" action="">
      {% csrf_token %}
      {{ form|crispy }}
    {% if 'play' in request.path %}
    {% block input %}
      <script>
        function input(e) {
          const tbInput = document.getElementById('tbInput');
          tbInput.value = tbInput.value + e.value;
        }

        function del() {
          const tbInput = document.getElementById('tbInput');
          tbInput.value = tbInput.value.substr(0, tbInput.value.length - 1);
        }
      </script>
    {% endblock %}
      <div class="row justify-content-center">
        <div class="form-group col-sm-3">
          <input class="form-control border-dark" id="tbInput" name="tbInput" type="text" autofocus>
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="form-group">
          <input class="btn btn-info pl-3 pr-3" type="button" value="1" onclick="input(this);" />
          <input class="btn btn-info pl-3 pr-3" type="button" value="2" onclick="input(this);" />
          <input class="btn btn-info pl-3 pr-3" type="button" value="3" onclick="input(this);" />
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="form-group">
          <input class="btn btn-info pl-3 pr-3" type="button" value="4" onclick="input(this);" />
          <input class="btn btn-info pl-3 pr-3" type="button" value="5" onclick="input(this);" />
          <input class="btn btn-info pl-3 pr-3" type="button" value="6" onclick="input(this);" />
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="form-group">
          <input class="btn btn-info pl-3 pr-3" type="button" value="7" onclick="input(this);" />
          <input class="btn btn-info pl-3 pr-3" type="button" value="8" onclick="input(this);" />
          <input class="btn btn-info pl-3 pr-3" type="button" value="9" onclick="input(this);" />
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="form-group">
          <input class="btn btn-info pl-3 pr-3" type="button" value="0" onclick="input(this)" />
          <input class="btn btn-info pl-3 pr-3" type="button" value="Clear" onclick="del();" />
        </div>
      </div>
      <div class="justify-content-center">
        <p class="float-left">Score: {{ Mathgame.score }}</p>
      </div>
      {% block timer %}
        <script>
          let timeleft = 29;
          let gameTimer = + this.setInterval(function(){
              if(timeleft <= 0){
                  window.location.href = "{% url 'mathgame:detail' mathgame.slug %}"
              } else {
                  document.getElementById("playerTime").innerHTML = timeleft;  
              }
              timeleft -= 1;
          }, 1000);
        </script>
      {% endblock %}
        <div id="time" class="d-flex justify-content-end">
          <p><strong>Time Left:</strong>&nbsp;</p>
          <p id="playerTime">30</p>
        </div>
      {% endif %}
      {% if 'start' in request.path %}
      <button class="btn btn-info btn-block">Go</button>
    </form>
    <br>
    <ol>
        <li>Select operation.</li>
        <li>Select max number.</li>
        <li >Press <strong>Go.</strong></li>
    </ol>
    <p class="font-weight-bold text-center text-uppercase text-warning">How many problems can you solve in 30 seconds?</p>
    {% endif %}
  </div>
{% endblock %}